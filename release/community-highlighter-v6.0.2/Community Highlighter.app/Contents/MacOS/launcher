#!/bin/bash

# Community Highlighter Launcher
# This script runs the Python GUI launcher

# Get the directory where this script is located
DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
RESOURCES="$DIR/../Resources"

cd "$RESOURCES"

# Find Python
if command -v python3 &> /dev/null; then
    PYTHON=python3
elif command -v python &> /dev/null; then
    PYTHON=python
else
    osascript -e 'display dialog "Python 3 is required but not installed.\n\nPlease install Python from:\nhttps://www.python.org/downloads/" buttons {"OK"} default button "OK" with icon stop with title "Community Highlighter"'
    exit 1
fi

# Check/create virtual environment
if [ ! -d "$RESOURCES/venv" ]; then
    osascript -e 'display notification "Setting up for first run... This may take a minute." with title "Community Highlighter"'
    $PYTHON -m venv "$RESOURCES/venv" 2>/dev/null
    if [ -d "$RESOURCES/venv" ]; then
        source "$RESOURCES/venv/bin/activate"
        pip install --upgrade pip --quiet 2>/dev/null
        pip install -r "$RESOURCES/requirements.txt" --quiet 2>/dev/null
    else
        # Fallback: use system Python if venv fails
        $PYTHON -m pip install -r "$RESOURCES/requirements.txt" --user --quiet 2>/dev/null
    fi
else
    source "$RESOURCES/venv/bin/activate" 2>/dev/null
fi

# Run the launcher
exec $PYTHON "$RESOURCES/launcher.py"
